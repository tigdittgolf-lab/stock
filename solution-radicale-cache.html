<!DOCTYPE html>
<html>
<head>
    <title>üîß Solution Radicale Cache</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; }
        .step { background: #e8f4fd; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #2196F3; }
        .critical { background: #ffebee; border-left-color: #f44336; }
        button { background: #4CAF50; color: white; padding: 15px 30px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 10px; }
        button:hover { background: #45a049; }
        .danger { background: #f44336; }
        .danger:hover { background: #da190b; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Solution Radicale - Probl√®me de Cache</h1>
        
        <div class="critical">
            <h3>‚ùå PROBL√àME IDENTIFI√â</h3>
            <p>Le backend fonctionne parfaitement et retourne les bonnes donn√©es MySQL, mais ton navigateur cache les anciennes donn√©es Supabase.</p>
        </div>
        
        <h3>üöÄ SOLUTION IMM√âDIATE</h3>
        
        <div class="step">
            <h4>1Ô∏è‚É£ VIDER COMPL√àTEMENT LE CACHE</h4>
            <p>Dans ton navigateur :</p>
            <ul>
                <li>Appuie sur <strong>F12</strong> (outils d√©veloppeur)</li>
                <li>Va dans l'onglet <strong>Application</strong> (Chrome) ou <strong>Storage</strong> (Firefox)</li>
                <li>Clique sur <strong>Clear Storage</strong></li>
                <li>Coche <strong>TOUT</strong> (Local Storage, Session Storage, Cache, etc.)</li>
                <li>Clique sur <strong>Clear site data</strong></li>
            </ul>
        </div>
        
        <div class="step">
            <h4>2Ô∏è‚É£ FORCER LE RECHARGEMENT</h4>
            <p>Apr√®s avoir vid√© le cache :</p>
            <ul>
                <li>Ferme <strong>compl√®tement</strong> le navigateur</li>
                <li>Rouvre le navigateur</li>
                <li>Va sur l'application Vercel</li>
                <li>Ou utilise <strong>Ctrl+Shift+R</strong> (rechargement forc√©)</li>
            </ul>
        </div>
        
        <div class="step">
            <h4>3Ô∏è‚É£ TEST EN MODE INCOGNITO</h4>
            <p>Pour confirmer que c'est un probl√®me de cache :</p>
            <ul>
                <li>Ouvre une <strong>fen√™tre incognito/priv√©e</strong></li>
                <li>Va sur : <a href="https://frontend-8e5ekyvfr-tigdittgolf-9191s-projects.vercel.app" target="_blank">https://frontend-8e5ekyvfr-tigdittgolf-9191s-projects.vercel.app</a></li>
                <li>Connecte-toi et teste le switch</li>
                <li>Si √ßa marche en incognito, c'est confirm√© que c'est le cache</li>
            </ul>
        </div>
        
        <div class="step critical">
            <h4>4Ô∏è‚É£ SI √áA NE MARCHE TOUJOURS PAS</h4>
            <p>Utilise ce lien direct pour tester l'API :</p>
            <button onclick="testAPI()">üß™ Tester API Directement</button>
            <div id="apiResult" style="margin-top: 10px; padding: 10px; background: #f5f5f5; border-radius: 5px; display: none;"></div>
        </div>
        
        <h3>üìã √âTAPES DE V√âRIFICATION</h3>
        
        <div class="step">
            <p><strong>Apr√®s avoir vid√© le cache :</strong></p>
            <ol>
                <li>Va sur l'application Vercel</li>
                <li>Connecte-toi avec admin/admin123</li>
                <li>Va dans Admin > Configuration Base de Donn√©es</li>
                <li>S√©lectionne MySQL ‚Üí Teste ‚Üí Change de Base</li>
                <li>Va dans Fournisseurs</li>
                <li><strong>Tu DOIS voir : "Outillage Pro" et "Visserie Express"</strong></li>
                <li>Retourne dans la config et s√©lectionne Supabase</li>
                <li><strong>Tu DOIS voir : "FOURNISSEUR 1", "FOURNISSEUR 2", etc.</strong></li>
            </ol>
        </div>
        
        <button class="danger" onclick="clearEverything()">üßπ VIDER TOUT LE CACHE (RADICAL)</button>
        
        <div style="margin-top: 30px; padding: 20px; background: #e8f5e8; border-radius: 5px;">
            <h4>‚úÖ CONFIRMATION</h4>
            <p>Mes tests automatiques confirment que le backend fonctionne parfaitement :</p>
            <ul>
                <li>‚úÖ Switch MySQL ‚Üí 2 fournisseurs (Outillage Pro, Visserie Express)</li>
                <li>‚úÖ Switch Supabase ‚Üí 4 fournisseurs (FOURNISSEUR 1, 2, 3, 4)</li>
                <li>‚úÖ Switch PostgreSQL ‚Üí 3 fournisseurs</li>
            </ul>
            <p><strong>Le probl√®me est 100% c√¥t√© cache navigateur.</strong></p>
        </div>
    </div>
    
    <script>
        async function testAPI() {
            const result = document.getElementById('apiResult');
            result.style.display = 'block';
            result.innerHTML = 'üîÑ Test en cours...';
            
            try {
                // Test direct de l'API
                const response = await fetch('https://his-affects-major-injured.trycloudflare.com/api/sales/suppliers', {
                    headers: {
                        'X-Tenant': '2025_bu01'
                    }
                });
                
                const data = await response.json();
                const suppliers = data.data || data;
                
                let html = `<strong>üìä R√©sultat API Direct :</strong><br>`;
                html += `üì¶ ${suppliers.length} fournisseurs<br>`;
                html += `üóÑÔ∏è DB Type: ${data.database_type}<br>`;
                html += `üîó Source: ${data.source}<br><br>`;
                
                if (suppliers.length > 0) {
                    html += `üìã Fournisseurs :<br>`;
                    suppliers.forEach((s, i) => {
                        html += `${i+1}. ${s.nom_fournisseur} (${s.nfournisseur})<br>`;
                    });
                    
                    const hasMySQL = suppliers.some(s => s.nom_fournisseur?.includes('Outillage'));
                    const hasSupabase = suppliers.some(s => s.nom_fournisseur?.includes('FOURNISSEUR'));
                    
                    if (hasMySQL) {
                        html += `<br><span style="color: green;">‚úÖ API retourne donn√©es MySQL correctes</span>`;
                    } else if (hasSupabase) {
                        html += `<br><span style="color: orange;">‚ö†Ô∏è API retourne donn√©es Supabase</span>`;
                    }
                }
                
                result.innerHTML = html;
                
            } catch (error) {
                result.innerHTML = `‚ùå Erreur: ${error.message}`;
            }
        }
        
        function clearEverything() {
            // Vider tout le cache possible
            if (typeof localStorage !== 'undefined') {
                localStorage.clear();
            }
            if (typeof sessionStorage !== 'undefined') {
                sessionStorage.clear();
            }
            
            // Forcer le rechargement
            window.location.reload(true);
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html>
<head>
    <title>Test RPC Functions</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test { margin: 15px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        pre { background: #f8f9fa; padding: 10px; overflow-x: auto; font-size: 12px; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>ğŸ” Test des Fonctions RPC</h1>
    <button onclick="testAllRPC()">ğŸš€ Tester toutes les fonctions</button>
    <button onclick="clearResults()">ğŸ§¹ Effacer</button>
    
    <div id="results"></div>

    <script>
        async function testAllRPC() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="test">ğŸ”„ Tests en cours...</div>';
            
            const baseUrl = window.location.origin;
            const tenant = '2025_bu01';
            
            // Test 1: API Familles
            await testAPI('ğŸ“‹ Test Familles', `${baseUrl}/api/settings/families`, { 'X-Tenant': tenant });
            
            // Test 2: API ActivitÃ©
            await testAPI('ğŸ¢ Test ActivitÃ©', `${baseUrl}/api/settings/activities`, { 'X-Tenant': tenant });
            
            // Test 3: API Articles (pour vÃ©rifier les familles)
            await testAPI('ğŸ“¦ Test Articles', `${baseUrl}/api/articles`, { 'X-Tenant': tenant });
            
            // Test 4: API BL (pour vÃ©rifier la colonne marge)
            await testAPI('ğŸ“„ Test BL', `${baseUrl}/api/sales/delivery-notes`, { 'X-Tenant': tenant });
        }
        
        async function testAPI(title, url, headers) {
            const results = document.getElementById('results');
            
            try {
                console.log(`ğŸ” Testing: ${title} - ${url}`);
                
                const response = await fetch(url, { headers });
                const data = await response.json();
                
                const isSuccess = response.ok && data.success !== false;
                
                results.innerHTML += `
                    <div class="test ${isSuccess ? 'success' : 'error'}">
                        <h3>${title} ${isSuccess ? 'âœ…' : 'âŒ'}</h3>
                        <p><strong>URL:</strong> ${url}</p>
                        <p><strong>Status:</strong> ${response.status} ${response.statusText}</p>
                        <p><strong>Success:</strong> ${data.success}</p>
                        ${data.data ? `<p><strong>Data Count:</strong> ${Array.isArray(data.data) ? data.data.length : (data.data ? 'Object' : 'None')}</p>` : ''}
                        ${data.error ? `<p><strong>Error:</strong> ${data.error}</p>` : ''}
                        ${data.debug ? `<p><strong>Debug:</strong> ${JSON.stringify(data.debug)}</p>` : ''}
                        <details>
                            <summary>Voir la rÃ©ponse complÃ¨te</summary>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </details>
                    </div>
                `;
            } catch (error) {
                results.innerHTML += `
                    <div class="test error">
                        <h3>${title} âŒ</h3>
                        <p><strong>URL:</strong> ${url}</p>
                        <p><strong>Error:</strong> ${error.message}</p>
                        <pre>${error.stack}</pre>
                    </div>
                `;
            }
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        // Test automatique au chargement
        window.onload = () => {
            setTimeout(testAllRPC, 1000);
        };
    </script>
</body>
</html>
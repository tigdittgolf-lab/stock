/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package Stock;

import java.awt.event.KeyEvent;
import java.sql.Connection;
import java.sql.Date;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.Statement;
import javax.swing.JOptionPane;

/**
 *
 * @author IT
 */
public class rappel_fa_achat extends javax.swing.JFrame {

    /**
     * Creates new form rappel_fa_achat
     */
    public rappel_fa_achat(String par,String det, String mas, String bas) {
        parametre =par; 
        fichier_detail= det;
        fichier_master=mas;   
        base= bas;
        initComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel1 = new javax.swing.JPanel();
        txt_nfact = new javax.swing.JTextField();
        txt_montant_tot_fact = new javax.swing.JTextField();
        txt_n_cheque = new javax.swing.JTextField();
        txt_banque = new javax.swing.JTextField();
        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        jLabel6 = new javax.swing.JLabel();
        jLabel7 = new javax.swing.JLabel();
        date_fact = new com.toedter.calendar.JDateChooser();
        txt_code_four = new javax.swing.JTextField();
        jComboBox1 = new javax.swing.JComboBox();
        txt_stock_f = new javax.swing.JTextField();
        txt_stock_bl = new javax.swing.JTextField();
        jLabel17 = new javax.swing.JLabel();
        jLabel18 = new javax.swing.JLabel();
        jScrollPane1 = new javax.swing.JScrollPane();
        Table_Factures = new javax.swing.JTable();
        txt_total_tva = new javax.swing.JTextField();
        jLabel14 = new javax.swing.JLabel();
        jLabel16 = new javax.swing.JLabel();
        txt_timbre = new javax.swing.JTextField();
        jLabel15 = new javax.swing.JLabel();
        txt_s_total = new javax.swing.JTextField();
        btn_rappeler = new javax.swing.JButton();
        btn_supprimer = new javax.swing.JButton();
        btn_quiter = new javax.swing.JButton();
        txt_titre = new javax.swing.JTextField();
        jLabel19 = new javax.swing.JLabel();
        txt_ttc = new javax.swing.JTextField();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setTitle("Rappel des achats");
        setExtendedState(javax.swing.JFrame.MAXIMIZED_BOTH);
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowOpened(java.awt.event.WindowEvent evt) {
                formWindowOpened(evt);
            }
        });

        txt_montant_tot_fact.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txt_montant_tot_fact.setEnabled(false);
        txt_montant_tot_fact.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                txt_montant_tot_factFocusLost(evt);
            }
        });

        txt_n_cheque.setEnabled(false);

        txt_banque.setEnabled(false);

        jLabel1.setText("N°Facture ");

        jLabel2.setText("Date Facture");

        jLabel3.setText("Code fournisseur ");

        jLabel4.setText("Nom");

        jLabel5.setText("Montant Facture");

        jLabel6.setText("N°Cheque");

        jLabel7.setText("Banque ");

        date_fact.setEnabled(false);

        txt_code_four.setCursor(new java.awt.Cursor(java.awt.Cursor.TEXT_CURSOR));
        txt_code_four.setVerifyInputWhenFocusTarget(false);
        txt_code_four.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                txt_code_fourFocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                txt_code_fourFocusLost(evt);
            }
        });
        txt_code_four.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txt_code_fourActionPerformed(evt);
            }
        });
        txt_code_four.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txt_code_fourKeyReleased(evt);
            }
        });

        jComboBox1.addPopupMenuListener(new javax.swing.event.PopupMenuListener() {
            public void popupMenuCanceled(javax.swing.event.PopupMenuEvent evt) {
            }
            public void popupMenuWillBecomeInvisible(javax.swing.event.PopupMenuEvent evt) {
                jComboBox1PopupMenuWillBecomeInvisible(evt);
            }
            public void popupMenuWillBecomeVisible(javax.swing.event.PopupMenuEvent evt) {
            }
        });

        txt_stock_f.setEditable(false);
        txt_stock_f.setEnabled(false);

        txt_stock_bl.setEditable(false);
        txt_stock_bl.setEnabled(false);

        jLabel17.setText("Stock F");

        jLabel18.setText("Stock BL");

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGap(32, 32, 32)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addComponent(jLabel5)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                        .addComponent(jLabel1)
                        .addGap(38, 38, 38)))
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(txt_nfact, javax.swing.GroupLayout.PREFERRED_SIZE, 80, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(txt_montant_tot_fact, javax.swing.GroupLayout.PREFERRED_SIZE, 109, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(9, 9, 9)
                .addComponent(jLabel2)
                .addGap(12, 12, 12)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addComponent(jLabel6)
                        .addGap(18, 18, 18)
                        .addComponent(txt_n_cheque, javax.swing.GroupLayout.PREFERRED_SIZE, 74, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(30, 30, 30)
                        .addComponent(jLabel7)
                        .addGap(18, 18, 18)
                        .addComponent(txt_banque, javax.swing.GroupLayout.PREFERRED_SIZE, 66, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addComponent(date_fact, javax.swing.GroupLayout.PREFERRED_SIZE, 143, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(18, 18, 18)
                        .addComponent(jLabel3)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(txt_code_four, javax.swing.GroupLayout.PREFERRED_SIZE, 63, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(2, 2, 2)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 54, Short.MAX_VALUE)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addComponent(jLabel4)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(jComboBox1, javax.swing.GroupLayout.PREFERRED_SIZE, 183, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(txt_stock_f, javax.swing.GroupLayout.PREFERRED_SIZE, 59, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jLabel17))
                        .addGap(26, 26, 26)
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel18)
                            .addComponent(txt_stock_bl, javax.swing.GroupLayout.PREFERRED_SIZE, 59, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addContainerGap())))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGap(31, 31, 31)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(txt_nfact, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(jLabel1)
                        .addComponent(jLabel2)
                        .addComponent(jLabel3)
                        .addComponent(jLabel4)
                        .addComponent(txt_code_four, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(jComboBox1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(date_fact, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 43, Short.MAX_VALUE)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(txt_montant_tot_fact, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(txt_n_cheque, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(txt_banque, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jLabel5)
                            .addComponent(jLabel6)
                            .addComponent(jLabel7))
                        .addGap(28, 28, 28))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel17)
                            .addComponent(jLabel18))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(txt_stock_f, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(txt_stock_bl, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addContainerGap())))
        );

        Table_Factures.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "Title 1", "Title 2", "Title 3", "Title 4"
            }
        ));
        Table_Factures.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                Table_FacturesMouseClicked(evt);
            }
        });
        Table_Factures.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                Table_FacturesKeyReleased(evt);
            }
        });
        jScrollPane1.setViewportView(Table_Factures);

        txt_total_tva.setEditable(false);
        txt_total_tva.setBackground(new java.awt.Color(255, 255, 255));
        txt_total_tva.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txt_total_tva.setDisabledTextColor(new java.awt.Color(0, 0, 0));
        txt_total_tva.setEnabled(false);

        jLabel14.setText("Timbre ");

        jLabel16.setText("S / Total");

        txt_timbre.setEditable(false);
        txt_timbre.setBackground(new java.awt.Color(255, 255, 255));
        txt_timbre.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txt_timbre.setDisabledTextColor(new java.awt.Color(0, 0, 0));
        txt_timbre.setEnabled(false);

        jLabel15.setText("T.V.A");

        txt_s_total.setEditable(false);
        txt_s_total.setBackground(new java.awt.Color(255, 255, 255));
        txt_s_total.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txt_s_total.setDisabledTextColor(new java.awt.Color(0, 0, 0));
        txt_s_total.setEnabled(false);

        btn_rappeler.setText("Rappeler");
        btn_rappeler.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_rappelerActionPerformed(evt);
            }
        });

        btn_supprimer.setText("Supprimer");
        btn_supprimer.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_supprimerActionPerformed(evt);
            }
        });

        btn_quiter.setText("Quitter");
        btn_quiter.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_quiterActionPerformed(evt);
            }
        });

        txt_titre.setEditable(false);
        txt_titre.setBackground(new java.awt.Color(51, 51, 255));
        txt_titre.setFont(new java.awt.Font("Verdana", 1, 16)); // NOI18N
        txt_titre.setForeground(new java.awt.Color(255, 255, 255));
        txt_titre.setHorizontalAlignment(javax.swing.JTextField.CENTER);
        txt_titre.setFocusable(false);
        txt_titre.setVerifyInputWhenFocusTarget(false);

        jLabel19.setText("Total TTC");

        txt_ttc.setEditable(false);
        txt_ttc.setBackground(new java.awt.Color(255, 255, 255));
        txt_ttc.setHorizontalAlignment(javax.swing.JTextField.RIGHT);
        txt_ttc.setDisabledTextColor(new java.awt.Color(0, 0, 0));
        txt_ttc.setEnabled(false);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(52, 52, 52)
                        .addComponent(btn_rappeler)
                        .addGap(100, 100, 100)
                        .addComponent(btn_supprimer)
                        .addGap(483, 483, 483)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(jLabel16)
                            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                .addComponent(jLabel15)
                                .addComponent(jLabel14))
                            .addComponent(jLabel19))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(txt_total_tva, javax.swing.GroupLayout.PREFERRED_SIZE, 111, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(txt_timbre, javax.swing.GroupLayout.PREFERRED_SIZE, 111, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(txt_s_total, javax.swing.GroupLayout.PREFERRED_SIZE, 111, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(txt_ttc, javax.swing.GroupLayout.PREFERRED_SIZE, 111, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(jScrollPane1)
                        .addGap(10, 10, 10))
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(0, 0, Short.MAX_VALUE))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                        .addGap(0, 0, Short.MAX_VALUE)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                                .addComponent(txt_titre, javax.swing.GroupLayout.PREFERRED_SIZE, 188, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(28, 28, 28))
                            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                                .addComponent(btn_quiter)
                                .addGap(29, 29, 29))))))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(txt_titre, javax.swing.GroupLayout.PREFERRED_SIZE, 34, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(26, 26, 26)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 118, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(100, 100, 100)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(txt_s_total, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel16))
                .addGap(2, 2, 2)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(txt_timbre, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(txt_total_tva, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel14)
                            .addComponent(btn_rappeler)
                            .addComponent(btn_supprimer))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jLabel15)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel19)
                    .addComponent(txt_ttc, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(btn_quiter))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void txt_montant_tot_factFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txt_montant_tot_factFocusLost
        //String txt_int =txt_montant_tot_fact.getText();
        txt_montant_tot_fact.setText(mntFmt.mntFmt(Double.parseDouble((txt_montant_tot_fact.getText()))));

    }//GEN-LAST:event_txt_montant_tot_factFocusLost

    private void txt_code_fourActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txt_code_fourActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txt_code_fourActionPerformed

    private void txt_code_fourFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txt_code_fourFocusGained
        txt_code_four.setText("");
    }//GEN-LAST:event_txt_code_fourFocusGained
private void fillCombo1() {
    String sql ="select * from fournisseur order by nom_fournisseur";
    try {
    jComboBox1.addItem("          ");    
    Rs = St.executeQuery(sql);
    while (Rs.next() ) {
       String nme = Rs.getString("nom_fournisseur");
       //String nme1 = Rs.getString("nfournisseur");
       jComboBox1.addItem(nme);
    }
    
    } catch (Exception e) {
                JOptionPane.showMessageDialog(null, "Erreur dans la liste jComboBox1\n" + e.getMessage());
            }
    }
    
    private void txt_code_fourFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txt_code_fourFocusLost

       txt_code_four.setInputVerifier(new Pass_Verifier_Fournisseur(base));
        String sql = "select * from fournisseur where nfournisseur = '" + txt_code_four.getText() +"'";
        try {
            Rs = St.executeQuery(sql);
            if (Rs.next()) {
                String add =  Rs.getString("nom_fournisseur");
                String add1 = txt_code_four.getText();
                txt_code_four.setText(add1);

                for (j=0 ; j < jComboBox1.getItemCount() ; j++) {

                    if (add.equals(jComboBox1.getItemAt(j).toString())) {

                        break;
                    }
                }
                jComboBox1.setSelectedIndex(j);
            }   else {
            }

        } catch (Exception e) {
            JOptionPane.showMessageDialog(null, "Erreur dans le comboBox \n" + e.getMessage());
        }
    }//GEN-LAST:event_txt_code_fourFocusLost

    private void txt_code_fourKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txt_code_fourKeyReleased
       try {
            String sql = "select * from fournisseur where nfournisseur = '" + txt_code_four.getText() + "'";
            Rs = St.executeQuery(sql);

            if (Rs.next()) {
                //JOptionPane.showMessageDialog(null, "trouvé");
                String add4 = Rs.getString("nom_fournisseur");
                String add5 = txt_code_four.getText();
                for (j=0 ; j < jComboBox1.getItemCount() ; j++) {

                    if (add4.equals(jComboBox1.getItemAt(j).toString())) {

                        break;
                    }
                }
                jComboBox1.setSelectedIndex(j);

            } else {
                // JOptionPane.showMessageDialog(null, txt_code_art);
                jComboBox1.setSelectedIndex(0);
            }
        } catch (Exception e) {
            JOptionPane.showMessageDialog(null, "Erreur dans l'insertion table\n" + e.getMessage());
        }
    }//GEN-LAST:event_txt_code_fourKeyReleased
    
    private void Table_FacturesMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_Table_FacturesMouseClicked
        try {
            
        } catch (Exception e) {
            JOptionPane.showMessageDialog(null, "Erreur dans la table\n" + e.getMessage());
        }

    }//GEN-LAST:event_Table_FacturesMouseClicked
    
    
    private void Table_FacturesKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_Table_FacturesKeyReleased
        if (evt.getKeyCode() == KeyEvent.VK_DOWN || evt.getKeyCode() == KeyEvent.VK_UP || evt.getKeyCode() == KeyEvent.VK_PAGE_UP || evt.getKeyCode() == KeyEvent.VK_PAGE_DOWN || evt.getKeyCode() == KeyEvent.VK_HOME || evt.getKeyCode() == KeyEvent.VK_END) {
            try {
              /*  int row = Table_Factures.getSelectedRow();
                String Table_click = (Table_Factures.getModel().getValueAt(row, 0).toString());
                String sql = "select F.id as \"Seq.\", F.Narticle as \"Code Article\", A.Designation as \"Designation\", F.prix as \"Prix Unitaire\", A.tva as \"TVA\", F.qte as \"Quantité\", F.total_ligne as \"Prix Total\"  from facture_a AS F, article AS A where F.narticle=A.narticle and F.id ='"+ Table_click + "'";

                //Connection cnx = DriverManager.getConnection("jdbc:mysql://localhost:3306/test", "root", "");
                St = cnx.createStatement();
                Rs = St.executeQuery(sql);
                if (Rs.next()) {
                   // affiche_champs();
                }*/
            } catch (Exception e) {
                JOptionPane.showMessageDialog(null, "Erreur dans la table\n" + e.getMessage());
            }
        }

    }//GEN-LAST:event_Table_FacturesKeyReleased

    private void btn_rappelerActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_rappelerActionPerformed
        // rappeler une facture_a si la table facture_a est vide.
        try {
                   
                        date_fact.setDate(null);
                        txt_montant_tot_fact.setText("");
                        txt_s_total.setText("");
                        txt_ttc.setText("");
                        txt_n_cheque.setText("");
                        txt_banque.setText("");
                        txt_total_tva.setText("");
                        txt_timbre.setText("");
                        txt_ttc.setText("");
                        // jComboBox1.setSelectedIndex(0);
                        //txt_code_four.setText("");
                    query ="truncate table facture_a";
                    St.execute(query);
                    tm = new MyTableModel("select * from facture_a",base);
                    Table_Factures.setModel(tm);
                    Table_Factures.setDefaultRenderer(Double.class, new TKMntRenderer());
                     String sql_txt =" select  montant_ht+tva+timbre as ttc from " +fichier_master+" where nfact ='"+txt_nfact.getText()+"' and nfournisseur ='"+txt_code_four.getText()+"'" ;                     
                      
                      Rs=St.executeQuery(sql_txt);
                      if (Rs.next()) {
                      ttc = Rs.getString("ttc");
                      xtot_ttc = Double.parseDouble(ttc);
                      txt_ttc.setText(ttc);
                      }
                    query = "insert into facture_a (nfact, narticle,nfournisseur, qte,tva,prix,total_ligne)  select nfact, narticle,nfournisseur, qte,tva,prix,total_ligne from "+fichier_detail+" where nfact ='"+txt_nfact.getText()+"' and nfournisseur ='"+txt_code_four.getText()+"'" ;                    
                    St.executeUpdate(query);
                    //JOptionPane.showMessageDialog(null,query);
                    String req =" select * from " +fichier_master+" where nfact ='"+txt_nfact.getText()+"' and nfournisseur ='"+txt_code_four.getText()+"'" ;
                    Rs=St.executeQuery(req);
                    if (Rs.next()) {
                        Date ad1 = Rs.getDate("date_fact");
                        date_fact.setDate(ad1);
                        String ad2 = Rs.getString("montant_ht");
                        txt_montant_tot_fact.setText(ad2);
                        txt_s_total.setText(ad2);
                        String ad3 = Rs.getString("ncheque");
                        txt_n_cheque.setText(ad3);
                        String ad4 = Rs.getString("banque");
                        txt_banque.setText(ad4);
                        String ad5 = Rs.getString("tva");
                        txt_total_tva.setText(ad5);
                        String ad6 = Rs.getString("timbre");
                        txt_timbre.setText(ad6);
                        txt_ttc.setText(ttc);
                    String sql = "select F.id as \"Seq.\", F.Narticle as \"Code Article\", A.Designation as \"Designation\", F.prix as \"Prix Unitaire\", A.tva as \"TVA\", F.qte as \"Quantité\", F.total_ligne as \"Prix Total\"  from facture_a AS F, article AS A where F.narticle=A.narticle order by F.id" ;
                    tm = new MyTableModel(sql,base);
                    Table_Factures.setModel(tm);
                    Table_Factures.setDefaultRenderer(Double.class, new TKMntRenderer());
                    } else 
                       {
                    
                    JOptionPane.showMessageDialog(null,"Facture inéxistante !");
                    }
            
        } catch(Exception e) {  JOptionPane.showMessageDialog(null, "Erreur  \n" + e.getMessage());
        }
    }//GEN-LAST:event_btn_rappelerActionPerformed

    private void jComboBox1PopupMenuWillBecomeInvisible(javax.swing.event.PopupMenuEvent evt) {//GEN-FIRST:event_jComboBox1PopupMenuWillBecomeInvisible
        String tmp = (String)jComboBox1.getSelectedItem();
        //JOptionPane.showMessageDialog(null, tmp );
        String sql = "select * from fournisseur where nom_fournisseur = '" + tmp + "'";
        try {
            Rs = St.executeQuery(sql);
            if (Rs.next()) {
                String add = Rs.getString("nfournisseur");
                txt_code_four.setText(add);
            } else {
                JOptionPane.showMessageDialog(null, "Pas de fournisseur pour ce code" );
            }
        } catch (Exception e) { JOptionPane.showMessageDialog(null, "Erreur dans le comboBox \n" + e.getMessage());
        }
    }//GEN-LAST:event_jComboBox1PopupMenuWillBecomeInvisible
    
    private void formWindowOpened(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowOpened
        String pilote = "com.mysql.jdbc.Driver";
        
        try {
            // connexion avec la base de donnée 
            if( fichier_master.equals("fachat")) {
            txt_titre.setText("Facture d'Achat" );
                    } else {
            txt_titre.setText("B.L d'Achat" );
            }
            Class.forName(pilote);
            cnx = DriverManager.getConnection("jdbc:mysql://localhost:3306/mysql", "root", "");
            St = cnx.createStatement();  
           
           String sql = "select db_name from stock_table_parameter where code_activite='"+base+"'";
            Rs = St.executeQuery(sql);
            if (Rs.next()) {
            String var_cnx= "jdbc:mysql://localhost:3306/"+Rs.getString("db_name");
            var_cnx=var_cnx+"_"+base;    
            String user_bd="root";
            String passwd_bd="";
            cnx = DriverManager.getConnection(var_cnx, user_bd, passwd_bd);
            St = cnx.createStatement();
            St1 = cnx.createStatement();
            St2 = cnx.createStatement();
            }
            query ="truncate table facture_a";
            St.execute(query);
            fillCombo1();                       
        } catch (Exception e) {
            JOptionPane.showMessageDialog(null, "Erreur de connexcion\n" + e.getMessage());
        }                                  
    }//GEN-LAST:event_formWindowOpened

    private void btn_quiterActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_quiterActionPerformed
       try{
       query ="truncate table facture_a";
       St.execute(query);
        this.dispose();
        } catch (Exception e) {
            JOptionPane.showMessageDialog(null, "Erreur de connexcion\n" + e.getMessage());
        }  
    }//GEN-LAST:event_btn_quiterActionPerformed


    private void mettre_jour_stock(String xcode_art, String oper, String qte, String type_fact)
    {
        
     int x_resultat = 0; 
   
    try {
        String sql= "select stock_f,stock_bl from article where narticle = '" + xcode_art + "'";            
        Rs3 = St1.executeQuery(sql);       
        if (Rs3.next()) {        
        String xstock_f = Rs3.getString(type_fact);
        int v_xstock_f = Integer.parseInt(xstock_f);
        int xqte = Integer.parseInt(qte);
       if ("ajouter".equals(oper) ) {
        x_resultat = v_xstock_f+xqte;
       } else {
        x_resultat = v_xstock_f-xqte;        
       }                                       
       String query = "update article set "+type_fact +" = '" +x_resultat +"' where narticle = '" +xcode_art+"'";                               
        St2.executeUpdate(query);
       }     
    }catch (Exception e) {
                JOptionPane.showMessageDialog(null, "Erreur dans la table\n" + e.getMessage());;    
    }    
   
 }
    

    
    private void btn_supprimerActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_supprimerActionPerformed
          
        try { 
                           
            Object[] options = {"Oui, je confirme!","Ooups, Non, Merci"};                 
            int r = JOptionPane.showOptionDialog(null, " Etes vous sur de vouloir Supprimer ?", "Confirmation",  JOptionPane.YES_NO_OPTION, JOptionPane.QUESTION_MESSAGE,null, options,options[1]);           
           
                if (r == 0) {     
                    String sql = "";
                    String query = "select id, Narticle , prix, tva, qte , total_ligne,type_fact from facture_a ";
                         
                   Rs1 = St.executeQuery(query);
                   if (parametre.equals("stock_f")) {
                        champ_ch_aff="caf";
                     }
                      else {
                         champ_ch_aff="cabl";
                          } 
                   int i =1;
            while(Rs1.next())
            { 
               // JOptionPane.showMessageDialog(null, i);
              //  i=i+1;
                String add1 = Rs1.getString("Narticle");
                String add2 = Rs1.getString("qte");              
                mettre_jour_stock(add1 , "restituer", add2,parametre);
            
            }
                    //nettoyer_facture.nettoyer_facture(base);
                      sql =" select  montant_ht+tva+timbre as ttc from " +fichier_master+" where nfact ='"+txt_nfact.getText()+"' and nfournisseur ='"+txt_code_four.getText()+"'" ;                     
                      
                      Rs=St.executeQuery(sql);
                      if (Rs.next()) {
                      ttc = Rs.getString("ttc");
                      xtot_ttc = Double.parseDouble(ttc);
                      txt_ttc.setText(ttc);
                      }
                       sql = " delete from "+fichier_detail+" where nfact ='"+txt_nfact.getText()+"' and nfournisseur ='"+txt_code_four.getText()+"'" ;
                       St.executeUpdate(sql);  
                       sql = " delete from "+fichier_master+" where nfact ='"+txt_nfact.getText()+"' and nfournisseur ='"+txt_code_four.getText()+"'" ;
                       St.executeUpdate(sql);
                                                                  
                        query = "select "+champ_ch_aff+"  from fournisseur where nfournisseur= '"+txt_code_four.getText()+"'";
                        Rs=St.executeQuery(query);
                        if (Rs.next()) {
                            String add1 = Rs.getString(champ_ch_aff);                               
                            xtot_ttc = Double.parseDouble(add1)-xtot_ttc;            
                            query = "update fournisseur set "+champ_ch_aff+"="+xtot_ttc+" where nfournisseur= '"+txt_code_four.getText()+"'";
                            St.executeUpdate(query);
                        }
                    

            sql ="truncate table facture_a";
            St.executeUpdate(sql);
           // vider_champs();
                        txt_nfact.setText("");
                        date_fact.setDate(null);
                        txt_montant_tot_fact.setText("");
                        txt_s_total.setText("");
                        txt_n_cheque.setText("");
                        txt_banque.setText("");
                        txt_total_tva.setText("");
                        txt_timbre.setText("");
                        txt_code_four.setText("");
                        txt_ttc.setText("");
                        jComboBox1.setSelectedIndex(0);
                        tm = new MyTableModel("select * from facture_a",base);
                        Table_Factures.setModel(tm);
                        Table_Factures.setDefaultRenderer(Double.class, new TKMntRenderer());
            //                                     
           } 
            } catch (Exception e) {
                JOptionPane.showMessageDialog(null, "Erreur dans la table\n" + e.getMessage());
            } 
        
    }//GEN-LAST:event_btn_supprimerActionPerformed
    
    
    /**
     * @param args the command line arguments
     */
     public static void rappel_fa_achat(final String par, final String det, final String mas, final String bas) {
   // public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(rappel_fa_achat.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(rappel_fa_achat.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(rappel_fa_achat.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(rappel_fa_achat.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new rappel_fa_achat(par,det,mas, bas).setVisible(true);
            }
        });
    }
    public Statement St,St1,St2,St3;
    public ResultSet Rs,Rs1,Rs2,Rs3;
    public Connection cnx;
    double xtot_ttc;
    public String parametre, fichier_detail, base, fichier_master,ttc,champ_ch_aff ="";
    String query;
    
    int j, int_nfact;
    MyTableModel tm;
    Double stot_ligne =0.00, prix_unitaire=0.00, add1_d=.00, timbre = 0.00, tva = 0.00, xtot_ht=0.00, xtot_tva=0.00;

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JTable Table_Factures;
    private javax.swing.JButton btn_quiter;
    private javax.swing.JButton btn_rappeler;
    private javax.swing.JButton btn_supprimer;
    private com.toedter.calendar.JDateChooser date_fact;
    private javax.swing.JComboBox jComboBox1;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel14;
    private javax.swing.JLabel jLabel15;
    private javax.swing.JLabel jLabel16;
    private javax.swing.JLabel jLabel17;
    private javax.swing.JLabel jLabel18;
    private javax.swing.JLabel jLabel19;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JTextField txt_banque;
    private javax.swing.JTextField txt_code_four;
    private javax.swing.JTextField txt_montant_tot_fact;
    private javax.swing.JTextField txt_n_cheque;
    private javax.swing.JTextField txt_nfact;
    private javax.swing.JTextField txt_s_total;
    private javax.swing.JTextField txt_stock_bl;
    private javax.swing.JTextField txt_stock_f;
    private javax.swing.JTextField txt_timbre;
    private javax.swing.JTextField txt_titre;
    private javax.swing.JTextField txt_total_tva;
    private javax.swing.JTextField txt_ttc;
    // End of variables declaration//GEN-END:variables
}

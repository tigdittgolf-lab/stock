<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vider le Cache Proforma</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; text-align: center; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        button { padding: 15px 30px; margin: 10px; background: #007bff; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; }
        button:hover { background: #0056b3; }
        .warning { background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 8px; margin: 20px 0; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; padding: 15px; border-radius: 8px; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üßπ Vider le Cache de l'Application Proforma</h1>
        
        <div class="warning">
            <h3>‚ö†Ô∏è Probl√®me d√©tect√©</h3>
            <p>Les filtres ne s'affichent pas sur la page des proformas. Cela peut √™tre d√ª au cache du navigateur.</p>
        </div>

        <h3>üîß Solutions:</h3>
        
        <button onclick="clearCacheAndReload()">
            üóëÔ∏è Vider le Cache et Recharger
        </button>
        
        <button onclick="openProformaWithNoCache()">
            üîÑ Ouvrir Proforma (Sans Cache)
        </button>
        
        <button onclick="openProformaNewTab()">
            üÜï Ouvrir dans Nouvel Onglet
        </button>
        
        <button onclick="hardRefresh()">
            ‚ö° Actualisation Forc√©e
        </button>

        <div id="result"></div>

        <div class="warning">
            <h4>üìã Instructions manuelles:</h4>
            <ol style="text-align: left;">
                <li><strong>Chrome/Edge:</strong> Ctrl+Shift+R ou F12 ‚Üí Network ‚Üí Disable cache</li>
                <li><strong>Firefox:</strong> Ctrl+Shift+R ou F12 ‚Üí Network ‚Üí Disable cache</li>
                <li><strong>Safari:</strong> Cmd+Option+R</li>
                <li><strong>Mode Incognito:</strong> Ouvrir en navigation priv√©e</li>
            </ol>
        </div>

        <div class="success">
            <h4>‚úÖ URL de Test:</h4>
            <p><a href="https://frontend-iota-six-72.vercel.app/proforma/list?v=2025010701" target="_blank">
                https://frontend-iota-six-72.vercel.app/proforma/list?v=2025010701
            </a></p>
            <p><small>Le param√®tre ?v= force le rechargement</small></p>
        </div>
    </div>

    <script>
        function clearCacheAndReload() {
            const result = document.getElementById('result');
            result.innerHTML = '<div class="warning">üîÑ Tentative de vidage du cache...</div>';
            
            // Vider le localStorage et sessionStorage
            localStorage.clear();
            sessionStorage.clear();
            
            // Forcer le rechargement sans cache
            setTimeout(() => {
                window.location.href = 'https://frontend-iota-six-72.vercel.app/proforma/list?nocache=' + Date.now();
            }, 1000);
        }

        function openProformaWithNoCache() {
            const timestamp = Date.now();
            const url = `https://frontend-iota-six-72.vercel.app/proforma/list?v=${timestamp}&nocache=true`;
            window.open(url, '_blank');
        }

        function openProformaNewTab() {
            window.open('https://frontend-iota-six-72.vercel.app/proforma/list', '_blank');
        }

        function hardRefresh() {
            const result = document.getElementById('result');
            result.innerHTML = '<div class="success">‚ö° Actualisation forc√©e en cours...</div>';
            
            // Essayer diff√©rentes m√©thodes de rafra√Æchissement forc√©
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(function(registrations) {
                    for(let registration of registrations) {
                        registration.unregister();
                    }
                });
            }
            
            setTimeout(() => {
                location.reload(true);
            }, 500);
        }

        // Test automatique au chargement
        window.onload = function() {
            const result = document.getElementById('result');
            result.innerHTML = `
                <div class="success">
                    <h4>üß™ Test de Connectivit√©</h4>
                    <p>Timestamp: ${new Date().toLocaleString('fr-FR')}</p>
                    <p>User Agent: ${navigator.userAgent.substring(0, 50)}...</p>
                    <p>URL actuelle: ${window.location.href}</p>
                </div>
            `;
        };
    </script>
</body>
</html>
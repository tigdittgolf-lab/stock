<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test URL Supabase</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .loading { background-color: #fff3cd; border-color: #ffeaa7; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
        input { width: 100%; padding: 8px; margin: 5px 0; }
    </style>
</head>
<body>
    <h1>üß™ Test URL Supabase</h1>
    
    <div class="test-section">
        <h2>Probl√®me Identifi√©</h2>
        <div style="background: #f8d7da; padding: 15px; border-radius: 5px;">
            <strong>‚ùå Erreur DNS:</strong> L'URL Supabase <code>szgodrjglbpzkrksnroi.supabase.co</code> ne peut pas √™tre r√©solue.<br>
            <strong>Cause probable:</strong> Projet Supabase supprim√©, URL incorrecte, ou probl√®me DNS temporaire.
        </div>
    </div>

    <div class="test-section">
        <h2>1. Test URL Supabase Actuelle</h2>
        <button onclick="testCurrentUrl()">Tester URL Actuelle</button>
        <div id="current-result"></div>
    </div>

    <div class="test-section">
        <h2>2. Test Nouvelle URL Supabase</h2>
        <p>Si vous avez une nouvelle URL Supabase, testez-la ici :</p>
        <input type="url" id="new-url" placeholder="https://votre-projet.supabase.co" value="https://szgodrjglbpzkrksnroi.supabase.co">
        <button onclick="testNewUrl()">Tester Nouvelle URL</button>
        <div id="new-result"></div>
    </div>

    <div class="test-section">
        <h2>3. Solutions Recommand√©es</h2>
        <div style="background: #e7f3ff; padding: 15px; border-radius: 5px;">
            <h3>üîß Options disponibles :</h3>
            <ol>
                <li><strong>V√©rifier le projet Supabase :</strong> Allez sur <a href="https://supabase.com" target="_blank">supabase.com</a> et v√©rifiez vos projets</li>
                <li><strong>Cr√©er un nouveau projet :</strong> Si l'ancien n'existe plus</li>
                <li><strong>Utiliser MySQL local :</strong> Fonctionne parfaitement (port 3307)</li>
                <li><strong>Utiliser PostgreSQL local :</strong> Fonctionne parfaitement (port 5432)</li>
            </ol>
        </div>
    </div>

    <div class="test-section">
        <h2>4. Test Bases de Donn√©es Locales</h2>
        <button onclick="testLocalDatabases()">Tester MySQL & PostgreSQL</button>
        <div id="local-result"></div>
    </div>

    <script>
        async function testCurrentUrl() {
            const resultDiv = document.getElementById('current-result');
            resultDiv.innerHTML = '<div class="loading">üîÑ Test de l\'URL actuelle...</div>';
            
            try {
                const response = await fetch('https://szgodrjglbpzkrksnroi.supabase.co', {
                    method: 'HEAD',
                    mode: 'no-cors'
                });
                
                resultDiv.innerHTML = `
                    <div class="success">
                        ‚úÖ URL accessible !
                        <p>L'URL Supabase r√©pond. Le probl√®me peut √™tre temporaire.</p>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå URL inaccessible
                        <p>Erreur: ${error.message}</p>
                        <p><strong>Recommandation:</strong> V√©rifiez votre projet Supabase ou utilisez une base de donn√©es locale.</p>
                    </div>
                `;
            }
        }

        async function testNewUrl() {
            const newUrl = document.getElementById('new-url').value;
            const resultDiv = document.getElementById('new-result');
            
            if (!newUrl || !newUrl.includes('supabase.co')) {
                resultDiv.innerHTML = '<div class="error">‚ùå Veuillez entrer une URL Supabase valide</div>';
                return;
            }
            
            resultDiv.innerHTML = '<div class="loading">üîÑ Test de la nouvelle URL...</div>';
            
            try {
                const response = await fetch(newUrl, {
                    method: 'HEAD',
                    mode: 'no-cors'
                });
                
                resultDiv.innerHTML = `
                    <div class="success">
                        ‚úÖ Nouvelle URL accessible !
                        <p>URL test√©e: <code>${newUrl}</code></p>
                        <p><strong>Action:</strong> Mettez √† jour le fichier <code>backend/.env</code> avec cette URL.</p>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå Nouvelle URL inaccessible
                        <p>URL test√©e: <code>${newUrl}</code></p>
                        <p>Erreur: ${error.message}</p>
                    </div>
                `;
            }
        }

        async function testLocalDatabases() {
            const resultDiv = document.getElementById('local-result');
            resultDiv.innerHTML = '<div class="loading">üîÑ Test des bases de donn√©es locales...</div>';
            
            try {
                // Test MySQL
                const mysqlResponse = await fetch('/api/database/test', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        type: 'mysql',
                        name: 'MySQL Local',
                        host: 'localhost',
                        port: 3307,
                        database: 'stock_management',
                        username: 'root',
                        password: ''
                    })
                });
                const mysqlData = await mysqlResponse.json();

                // Test PostgreSQL
                const pgResponse = await fetch('/api/database/test', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        type: 'postgresql',
                        name: 'PostgreSQL Local',
                        host: 'localhost',
                        port: 5432,
                        database: 'stock_management',
                        username: 'postgres',
                        password: 'postgres'
                    })
                });
                const pgData = await pgResponse.json();

                resultDiv.innerHTML = `
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
                        <h4>R√©sultats des tests locaux :</h4>
                        <div style="margin: 10px 0;">
                            <strong>üê¨ MySQL (port 3307):</strong> 
                            <span style="color: ${mysqlData.success ? 'green' : 'red'}">
                                ${mysqlData.success ? '‚úÖ OK' : '‚ùå ' + mysqlData.error}
                            </span>
                        </div>
                        <div style="margin: 10px 0;">
                            <strong>üêò PostgreSQL (port 5432):</strong> 
                            <span style="color: ${pgData.success ? 'green' : 'red'}">
                                ${pgData.success ? '‚úÖ OK' : '‚ùå ' + pgData.error}
                            </span>
                        </div>
                        ${(mysqlData.success || pgData.success) ? 
                            '<p style="color: green;"><strong>‚úÖ Vous pouvez utiliser les bases de donn√©es locales en attendant de r√©soudre le probl√®me Supabase.</strong></p>' :
                            '<p style="color: orange;"><strong>‚ö†Ô∏è Aucune base de donn√©es locale disponible. V√©rifiez que WAMP/PostgreSQL sont d√©marr√©s.</strong></p>'
                        }
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå Erreur lors du test des bases locales: ${error.message}
                    </div>
                `;
            }
        }
    </script>
</body>
</html>